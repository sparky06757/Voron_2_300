[include mainsail.cfg]
[include Macros.cfg]
[include DB_RB_led.cfg]
[include K-ShakeTune/*.cfg]

[delayed_gcode pre_heat]
initial_duration: .01
gcode:
  ABS_PREHEAT


[exclude_object]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_30003A001750344D30353320-if00
restart_method: command

[mcu can0]
canbus_uuid: eb442146719f  #e87c5e5749f2

# [mcu RPi4]
# serial: /tmp/klipper_host_mcu

[temperature_sensor Octopus]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[temperature_sensor can0]
sensor_type: temperature_mcu
sensor_mcu: can0
min_temp: 0
max_temp: 100

# [temperature_sensor RPi4]
# sensor_type: temperature_host
# min_temp: 0
# max_temp: 100

[temperature_sensor chamber]
sensor_type: Generic 3950
Sensor_pin: PF4

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[skew_correction]

[mcu scanner]
canbus_uuid: 7648b477a9a0 

[scanner]
mcu: scanner            
x_offset: 0                          
y_offset: 15                         
backlash_comp: 0.5
sensor: cartographer
sensor_alt: carto      
mesh_runs: 2

[bed_mesh]
zero_reference_position: 150, 150    
speed: 400
horizontal_move_z: 5
mesh_min: 25,25
mesh_max: 275, 275
probe_count: 20, 20
algorithm: bicubic

# [lis2dw]
# cs_pin: scanner:PA3
# spi_bus: spi1

# [resonance_tester]
# accel_chip: lis2dw
# probe_points:
#     150, 150, 20

[autotune_tmc stepper_x]
motor: ldo-42sth48-2004mah
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_y]
motor: ldo-42sth48-2004mah
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z1]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z2]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z3]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[input_shaper]
shaper_freq_x: 77.2 # center frequency for the X axis filter
shaper_type_x: mzv # filter type for the X axis
damping_ratio_x: 0.044 # damping ratio for the X axis
shaper_freq_y: 46.6 # center frequency for the Y axis filter
shaper_type_y: mzv # filter type for the Y axis
damping_ratio_y: 0.049 # damping ratio for the Y axis

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 12000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 300
square_corner_velocity: 6.0
minimum_cruise_ratio: 0.5

[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400
endstop_pin: can0:PB8
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 80
homing_retract_dist: 0
homing_positive_dir: True

[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400
endstop_pin: PG9
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 80  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32
endstop_pin: probe:z_virtual_endstop     
position_max: 255
position_min: -5
homing_speed: 15
second_homing_speed: 3
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PC6
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z3]
step_pin: PC13
dir_pin: PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[extruder]
step_pin: can0:PD0
dir_pin: !can0:PD1
enable_pin: !can0:PD2
rotation_distance: 22.67895
gear_ratio: 50:7
microsteps: 16
full_steps_per_rotation: 200
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
max_extrude_cross_section: 50
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: can0:PB13
sensor_pin: can0:PA3
sensor_type: ATC Semitec 104NT-4-R025H42G
#pullup_resistor: 2200
#control: pid
#pid_Kp: 21.507
#pid_Ki: 1.887
#pid_Kd: 61.296
min_extrude_temp: 200
min_temp: 0
max_temp: 305
pressure_advance: .04
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: can0:PA15
interpolate: true
run_current: 0.8
hold_current: 0.100
sense_resistor: 0.11
stealthchop_threshold: 0
driver_TBL: 0
driver_HEND: 6
driver_HSTRT: 7
driver_TOFF: 4

[filament_motion_sensor filament_sensor]
detection_length: 12
extruder: extruder
switch_pin: ^PG15
pause_on_runout: True
event_delay: 3.0
pause_delay: 0.5
runout_gcode:
    M117 Runout Detected!

# [filament_motion_sensor encoder_sensor]
# detection_length: 12
# extruder: extruder
# switch_pin: PG15
# # changing the switch_pin name according to your motherboard
# #pause_on_runout: True
# #runout_gcode: [pause_resume]
# #insert_gcode:
# #event_delay: 
# #pause_delay:

[gcode_arcs]
resolution: 1.0

[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PF3
max_power: 0.6
min_temp: 0
max_temp: 125
pwm_cycle_time: 0.0166
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

[verify_heater heater_bed]
max_error: 50
check_gain_time: 99999
hysteresis: 5
heating_gain: 2

[idle_timeout]
timeout: 26000

[heater_fan hotend_fan]
#  Hotend Fan - FAN1
pin: can0: PA0
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 35
fan_speed: 1.0

## PART COOLING - FAN2
[fan]
pin: can0: PA1
kick_start_time: 0.5
#cycle_time: 0.15
off_below: 0.10

[heater_fan Electronics_Right]
pin: PD13
kick_start_time: 0.5
shutdown_speed: 0.0
heater: heater_bed
heater_temp: 50
fan_speed: .35

[heater_fan Electronics_Left]
pin: PD14
kick_start_time: 0.5
shutdown_speed: 0.0
heater: heater_bed
heater_temp: 50
fan_speed: .35

[heater_fan Nevermore]
pin: PD12
max_power: 1.0
kick_start_time: 0.5
heater: heater_bed
heater_temp: 50.0

[safe_z_home]                 
home_xy_position: 150,150
z_hop: 10


[quad_gantry_level]
gantry_corners:
	-60,-10
	360,370
points:
    25,0
    25,250
    275,250
    275,0
speed: 350
horizontal_move_z: 5
retries: 10
retry_tolerance: 0.006
max_adjust: 10


# [bed_mesh]
# speed: 400
# horizontal_move_z: 7
# mesh_min: 25,25
# mesh_max: 275,265
# fade_start: 0.6
# fade_end: 10.0
# probe_count: 30,30
# mesh_pps:2,2
# algorithm: bicubic

[bed_mesh] #cart bed mesh
zero_reference_position: 150, 150  
speed: 350
horizontal_move_z: 5
mesh_min: 25, 25
mesh_max: 275, 265
probe_count: 20, 20

[adxl345]
cs_pin: can0: PB12
spi_software_sclk_pin: can0:PB10
spi_software_mosi_pin: can0:PB11
spi_software_miso_pin: can0:PB2
axes_map: x,y,z

[resonance_tester]
accel_chip: adxl345
probe_points:
   150,150,20

# Chamber Lighting
[output_pin caselight]
pin: PD15
#max_power: 1.0
#kick_start_time: 0.5
pwm: true
shutdown_value: 0
value: 1
cycle_time: 0.01
#scale: 100

[shaketune]
result_folder: ~/printer_data/config/ShakeTune_results
number_of_results_to_keep: 3
show_macros_in_webui: True
timeout: 300
dpi: 300

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.133
#*# pid_ki = 1.324
#*# pid_kd = 289.094
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.058
#*# pid_ki = 1.438
#*# pid_kd = 69.955
#*#
#*# [input_shaper]
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = -2.220446049250313e-16
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [scanner model default]
#*# model_coef = 1.3891764296415159,
#*# 	  1.8245867014573476,
#*# 	  0.7602690118387733,
#*# 	  0.31151395757211403,
#*# 	  0.3822141861440186,
#*# 	  0.49214997302265484,
#*# 	  -0.23998911360379058,
#*# 	  -0.4527468217987654,
#*# 	  0.25974018162272294,
#*# 	  0.2769320438324207
#*# model_domain = 3.2390556170687153e-07,3.3642361598900353e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 51.963301
#*# model_offset = 0.04000
#*# model_mode = scan
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.021172, 0.030644, 0.049308, 0.052137, 0.057707, 0.064339, 0.068825, 0.073299, 0.079742, 0.090621, 0.096333, 0.092339, 0.083948, 0.085595, 0.088064, 0.076162, 0.063689, 0.057990, 0.052803, 0.042001
#*# 	  0.005522, 0.021348, 0.029247, 0.025141, 0.036426, 0.042858, 0.049403, 0.051931, 0.058355, 0.060219, 0.067661, 0.070109, 0.067121, 0.065549, 0.053913, 0.053944, 0.056225, 0.039392, 0.020604, 0.010865
#*# 	  -0.005983, 0.010409, 0.018304, 0.024469, 0.030375, 0.036300, 0.042381, 0.054016, 0.044867, 0.054862, 0.059080, 0.069059, 0.059519, 0.050340, 0.061175, 0.056023, 0.043347, 0.028906, 0.026663, 0.014505
#*# 	  -0.011278, -0.000366, 0.015117, 0.010871, 0.024221, 0.035360, 0.037024, 0.037403, 0.048850, 0.051990, 0.065149, 0.053967, 0.057606, 0.062959, 0.061897, 0.045042, 0.039310, 0.047850, 0.032147, 0.014500
#*# 	  -0.031762, -0.012332, 0.004950, -0.003164, 0.003102, 0.017183, 0.029365, 0.028484, 0.035556, 0.041104, 0.051895, 0.046861, 0.046087, 0.043959, 0.040779, 0.038234, 0.041789, 0.030768, 0.020633, 0.009578
#*# 	  -0.024585, -0.008279, -0.012062, -0.004142, 0.011334, 0.011914, 0.012216, 0.014458, 0.034715, 0.039764, 0.038695, 0.041409, 0.032498, 0.041459, 0.032807, 0.031792, 0.032371, 0.032377, 0.016446, 0.004777
#*# 	  -0.026112, -0.009625, -0.002849, -0.009738, 0.001327, 0.012406, 0.017196, 0.010879, 0.021573, 0.032588, 0.025508, 0.026607, 0.027740, 0.028966, 0.017338, 0.023863, 0.028696, 0.022551, 0.008962, 0.001370
#*# 	  -0.032170, -0.027889, -0.016709, -0.008265, -0.009058, -0.005791, -0.004202, 0.010079, 0.013968, 0.019432, 0.017278, 0.028773, 0.018548, 0.016994, 0.012219, 0.024559, 0.023957, 0.021602, 0.011125, 0.008616
#*# 	  -0.050144, -0.033504, -0.024862, -0.015627, -0.019413, -0.020342, -0.014679, -0.002849, 0.010853, 0.013117, 0.014007, 0.018866, 0.022357, 0.021739, 0.017183, 0.015607, 0.024436, 0.027602, 0.021739, 0.011593
#*# 	  -0.048376, -0.033273, -0.023857, -0.024318, -0.025538, -0.014284, -0.009521, -0.005613, 0.003276, 0.018660, 0.020934, 0.018391, 0.023795, 0.020899, 0.022899, 0.024390, 0.027216, 0.027579, 0.026312, 0.019578
#*# 	  -0.054226, -0.045787, -0.044827, -0.031358, -0.028484, -0.024748, -0.023318, -0.007064, -0.000151, 0.004459, 0.011165, 0.012995, 0.013671, 0.013062, 0.018590, 0.016279, 0.018868, 0.021381, 0.025148, 0.023766
#*# 	  -0.058756, -0.054169, -0.049450, -0.046260, -0.038667, -0.032893, -0.024298, -0.018850, -0.011131, -0.005064, 0.003597, 0.005140, 0.003563, 0.006886, 0.007468, 0.011322, 0.011288, 0.014589, 0.020307, 0.023849
#*# 	  -0.056636, -0.049719, -0.049759, -0.046054, -0.038801, -0.037345, -0.027953, -0.016757, -0.014550, -0.007463, 0.001418, 0.007310, 0.003655, 0.005766, 0.010870, 0.011965, 0.014393, 0.018536, 0.021961, 0.021375
#*# 	  -0.054180, -0.056159, -0.048027, -0.044205, -0.038848, -0.033459, -0.027880, -0.019854, -0.012269, -0.005447, 0.001794, 0.005349, 0.006720, 0.008174, 0.009523, 0.011417, 0.014407, 0.019438, 0.020323, 0.020840
#*# 	  -0.044931, -0.039465, -0.039756, -0.036412, -0.034338, -0.026656, -0.024045, -0.013351, -0.006026, 0.001475, 0.008026, 0.015182, 0.016848, 0.019529, 0.023510, 0.025599, 0.030896, 0.036112, 0.037908, 0.039718
#*# 	  -0.026306, -0.033480, -0.026213, -0.025712, -0.022180, -0.015297, -0.005654, 0.001819, 0.012719, 0.016537, 0.023208, 0.029053, 0.028934, 0.030932, 0.034056, 0.034549, 0.039284, 0.042482, 0.040486, 0.039078
#*# 	  -0.022240, -0.016195, -0.015589, -0.012585, -0.008826, -0.002522, 0.006440, 0.010581, 0.015853, 0.021736, 0.027587, 0.031324, 0.032810, 0.034660, 0.035929, 0.034652, 0.034738, 0.037912, 0.036120, 0.033701
#*# 	  -0.019623, -0.004687, -0.007816, -0.003000, -0.001925, 0.004424, 0.010410, 0.013923, 0.017652, 0.019038, 0.023428, 0.026824, 0.028172, 0.032075, 0.034388, 0.036164, 0.039676, 0.042966, 0.044713, 0.044327
#*# 	  -0.012382, -0.019515, -0.013007, -0.013523, -0.007747, -0.000786, 0.007527, 0.011118, 0.014726, 0.019371, 0.022433, 0.025316, 0.030773, 0.032010, 0.031705, 0.034337, 0.036175, 0.039515, 0.039766, 0.040572
#*# 	  0.044111, 0.025756, 0.012668, 0.006267, 0.009198, 0.012187, 0.017307, 0.023532, 0.026534, 0.028317, 0.031576, 0.033177, 0.034378, 0.034752, 0.032755, 0.032626, 0.034140, 0.034518, 0.033926, 0.034310
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 25.0
#*# max_x = 275.0
#*# min_y = 25.0
#*# max_y = 265.0
