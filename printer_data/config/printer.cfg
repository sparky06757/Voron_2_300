[include mainsail.cfg]
[include Macros.cfg]
[include stealthburner_leds.cfg]
[include K-ShakeTune/*.cfg]

[delayed_gcode pre_heat]
initial_duration: .01
gcode:
  ABS_PREHEAT


[exclude_object]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_30003A001750344D30353320-if00
restart_method: command

[mcu can0]
canbus_uuid: eb442146719f  #e87c5e5749f2

# [mcu RPi4]
# serial: /tmp/klipper_host_mcu

[temperature_sensor Octopus]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[temperature_sensor can0]
sensor_type: temperature_mcu
sensor_mcu: can0
min_temp: 0
max_temp: 100

# [temperature_sensor RPi4]
# sensor_type: temperature_host
# min_temp: 0
# max_temp: 100

[temperature_sensor chamber]
sensor_type: Generic 3950
Sensor_pin: PF4

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[skew_correction]

[mcu scanner]
canbus_uuid: 7648b477a9a0 

[scanner]
mcu: scanner            
x_offset: 0                          
y_offset: 15                         
backlash_comp: 0.5
sensor: cartographer
sensor_alt: carto      
mesh_runs: 2

[bed_mesh]
zero_reference_position: 150, 150    
speed: 400
horizontal_move_z: 5
mesh_min: 25,25
mesh_max: 275, 275
probe_count: 20, 20
algorithm: bicubic

# [lis2dw]
# cs_pin: scanner:PA3
# spi_bus: spi1

# [resonance_tester]
# accel_chip: lis2dw
# probe_points:
#     150, 150, 20

[autotune_tmc stepper_x]
motor: ldo-42sth48-2004mah
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_y]
motor: ldo-42sth48-2004mah
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z1]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z2]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z3]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[input_shaper]
shaper_freq_x: 62.2 # center frequency for the X axis filter
shaper_type_x: mzv # filter type for the X axis
damping_ratio_x: 0.042 # damping ratio for the X axis
shaper_freq_y: 44.4 # center frequency for the Y axis filter
shaper_type_y: mzv # filter type for the Y axis
damping_ratio_y: 0.044 # damping ratio for the Y axis

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 12000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 300
square_corner_velocity: 5.0
minimum_cruise_ratio: 0.5

[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400
endstop_pin: can0:PB8
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 80
homing_retract_dist: 0
homing_positive_dir: True

[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400
endstop_pin: PG9
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 80  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32
endstop_pin: probe:z_virtual_endstop     
position_max: 255
position_min: -5
homing_speed: 15
second_homing_speed: 3
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PC6
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z3]
step_pin: PC13
dir_pin: PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[extruder]
step_pin: can0:PD0
dir_pin: !can0:PD1
enable_pin: !can0:PD2
rotation_distance: 22.67895
gear_ratio: 50:7
microsteps: 16
full_steps_per_rotation: 200
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
max_extrude_cross_section: 50
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: can0:PB13
sensor_pin: can0:PA3
sensor_type: ATC Semitec 104NT-4-R025H42G
#pullup_resistor: 2200
#control: pid
#pid_Kp: 21.507
#pid_Ki: 1.887
#pid_Kd: 61.296
min_extrude_temp: 200
min_temp: 0
max_temp: 305
pressure_advance: .04
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: can0:PA15
interpolate: true
run_current: 0.8
hold_current: 0.100
sense_resistor: 0.11
stealthchop_threshold: 0
driver_TBL: 0
driver_HEND: 6
driver_HSTRT: 7
driver_TOFF: 4

[filament_motion_sensor filament_sensor]
detection_length: 12
extruder: extruder
switch_pin: ^PG15
pause_on_runout: True
event_delay: 3.0
pause_delay: 0.5
runout_gcode:
    M117 Runout Detected!

# [filament_motion_sensor encoder_sensor]
# detection_length: 12
# extruder: extruder
# switch_pin: PG15
# # changing the switch_pin name according to your motherboard
# #pause_on_runout: True
# #runout_gcode: [pause_resume]
# #insert_gcode:
# #event_delay: 
# #pause_delay:

[gcode_arcs]
resolution: 1.0

[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PF3
max_power: 0.6
min_temp: 0
max_temp: 125
pwm_cycle_time: 0.0166
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

[verify_heater heater_bed]
max_error: 50
check_gain_time: 99999
hysteresis: 5
heating_gain: 2

[idle_timeout]
timeout: 26000

[heater_fan hotend_fan]
#  Hotend Fan - FAN1
pin: can0: PA0
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 35
fan_speed: 1.0

## PART COOLING - FAN2
[fan]
pin: can0: PA1
kick_start_time: 0.5
#cycle_time: 0.15
off_below: 0.10

[heater_fan Electronics_Right]
pin: PD13
kick_start_time: 0.5
shutdown_speed: 0.0
heater: heater_bed
heater_temp: 50
fan_speed: .35

[heater_fan Electronics_Left]
pin: PD14
kick_start_time: 0.5
shutdown_speed: 0.0
heater: heater_bed
heater_temp: 50
fan_speed: .35

[heater_fan Nevermore]
pin: PD12
max_power: 1.0
kick_start_time: 0.5
heater: heater_bed
heater_temp: 50.0

[safe_z_home]                 
home_xy_position: 150,150
z_hop: 10


[quad_gantry_level]
gantry_corners:
	-60,-10
	360,370
points:
    25,0
    25,250
    275,250
    275,0
speed: 500
horizontal_move_z: 5
retries: 10
retry_tolerance: 0.006
max_adjust: 10


# [bed_mesh]
# speed: 400
# horizontal_move_z: 7
# mesh_min: 25,25
# mesh_max: 275,265
# fade_start: 0.6
# fade_end: 10.0
# probe_count: 30,30
# mesh_pps:2,2
# algorithm: bicubic

[bed_mesh] #cart bed mesh
zero_reference_position: 150, 150  
speed: 400
horizontal_move_z: 5
mesh_min: 25, 25
mesh_max: 275, 265
probe_count: 20, 20

[adxl345]
cs_pin: can0: PB12
spi_software_sclk_pin: can0:PB10
spi_software_mosi_pin: can0:PB11
spi_software_miso_pin: can0:PB2
axes_map: x,y,z

[resonance_tester]
accel_chip: adxl345
probe_points:
   150,150,20

# Chamber Lighting
[output_pin caselight]
pin: PD15
#max_power: 1.0
#kick_start_time: 0.5
pwm: true
shutdown_value: 0
value: 1
cycle_time: 0.01
#scale: 100

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.133
#*# pid_ki = 1.324
#*# pid_kd = 289.094
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.058
#*# pid_ki = 1.438
#*# pid_kd = 69.955
#*#
#*# [input_shaper]
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = -2.220446049250313e-16
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [scanner model default]
#*# model_coef = 1.3675403272547682,
#*# 	  1.7937619056573224,
#*# 	  0.7553799487518319,
#*# 	  0.3877014150198633,
#*# 	  0.4184032998143007,
#*# 	  0.2991069507591693,
#*# 	  -0.2744815254069319,
#*# 	  -0.21061287405141232,
#*# 	  0.2826175667767271,
#*# 	  0.1804372746066715
#*# model_domain = 3.219964566634026e-07,3.359593890061353e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 22.690366
#*# model_offset = 0.48000
#*# model_mode = scan
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.044495, 0.060038, 0.067051, 0.072561, 0.069457, 0.080725, 0.086038, 0.095713, 0.096627, 0.099356, 0.109715, 0.122236, 0.115306, 0.111609, 0.100541, 0.089065, 0.087119, 0.076569, 0.070748, 0.057677
#*# 	  0.026948, 0.034566, 0.042610, 0.043359, 0.051240, 0.060550, 0.064415, 0.067107, 0.065256, 0.074623, 0.081926, 0.086929, 0.085849, 0.077079, 0.073166, 0.066961, 0.060409, 0.052458, 0.035581, 0.029773
#*# 	  0.019834, 0.018274, 0.033954, 0.048233, 0.041828, 0.047262, 0.051748, 0.050399, 0.059855, 0.062945, 0.067243, 0.069029, 0.067412, 0.070870, 0.061317, 0.052183, 0.051050, 0.043730, 0.039484, 0.024102
#*# 	  0.007260, 0.011420, 0.014001, 0.020111, 0.032371, 0.042502, 0.049434, 0.048402, 0.049474, 0.055841, 0.062211, 0.068845, 0.069079, 0.060937, 0.057475, 0.050065, 0.044984, 0.051319, 0.040719, 0.026408
#*# 	  -0.003064, 0.006107, -0.001335, 0.002301, 0.015548, 0.021373, 0.020558, 0.026728, 0.044863, 0.048604, 0.047401, 0.048922, 0.040256, 0.038343, 0.040073, 0.041125, 0.038966, 0.025889, 0.015978, 0.009570
#*# 	  -0.009680, 0.001028, 0.001683, 0.005714, 0.010704, 0.009914, 0.019475, 0.028426, 0.030083, 0.036205, 0.040127, 0.038971, 0.036299, 0.028298, 0.030318, 0.027413, 0.025824, 0.022062, 0.013384, 0.002637
#*# 	  -0.017645, -0.009324, -0.012089, 0.001371, 0.006373, 0.010209, 0.012187, 0.016107, 0.020889, 0.026404, 0.030116, 0.022811, 0.023347, 0.019174, 0.016803, 0.021321, 0.014095, 0.006000, 0.004001, -0.005048
#*# 	  -0.026853, -0.016277, -0.015843, -0.013373, -0.000981, 0.003552, 0.003873, 0.004112, 0.009912, 0.021239, 0.017370, 0.011776, 0.009252, 0.010052, 0.008027, 0.012469, 0.014070, 0.008288, 0.003849, -0.004962
#*# 	  -0.039191, -0.040224, -0.034495, -0.012898, -0.005207, 0.003595, -0.008259, -0.002717, -0.002962, 0.008569, 0.016361, 0.014324, 0.011742, 0.010214, 0.010240, 0.012244, 0.014859, 0.018345, 0.013250, 0.000016
#*# 	  -0.036486, -0.034288, -0.030817, -0.022011, -0.008983, 0.004248, -0.001244, -0.000775, 0.005042, 0.010668, 0.018196, 0.022162, 0.016074, 0.014717, 0.016037, 0.017524, 0.019824, 0.018186, 0.014713, 0.006368
#*# 	  -0.046314, -0.043448, -0.047407, -0.034649, -0.023439, -0.013497, -0.015924, -0.013244, -0.007012, 0.000896, 0.008178, 0.012958, 0.009603, 0.009344, 0.010460, 0.012238, 0.013761, 0.009968, 0.010291, 0.006205
#*# 	  -0.053766, -0.041571, -0.046444, -0.045515, -0.039252, -0.033508, -0.022569, -0.019340, -0.012530, -0.006505, 0.003670, 0.002650, 0.001465, 0.004000, 0.003087, 0.006001, 0.009805, 0.008855, 0.012064, 0.008421
#*# 	  -0.050114, -0.041365, -0.040561, -0.037129, -0.041372, -0.036630, -0.024905, -0.019106, -0.009870, 0.000170, 0.005132, 0.001795, 0.001611, 0.007405, 0.007223, 0.008712, 0.014652, 0.017188, 0.016767, 0.013942
#*# 	  -0.047426, -0.040845, -0.038140, -0.035804, -0.033239, -0.029863, -0.020484, -0.015631, -0.009283, -0.003327, 0.001671, 0.006132, 0.009803, 0.010633, 0.013574, 0.011813, 0.017643, 0.020906, 0.023040, 0.022178
#*# 	  -0.032076, -0.026589, -0.023488, -0.023583, -0.021107, -0.015656, -0.011712, -0.010426, -0.000589, 0.011478, 0.015256, 0.020633, 0.024465, 0.028613, 0.029064, 0.031040, 0.035746, 0.041576, 0.043601, 0.045589
#*# 	  -0.016153, -0.011533, -0.010573, -0.009274, -0.008040, -0.000720, 0.006220, 0.014376, 0.020988, 0.028341, 0.032322, 0.038425, 0.040538, 0.042552, 0.042847, 0.043470, 0.048332, 0.050838, 0.050883, 0.050564
#*# 	  -0.007173, 0.000406, 0.007602, 0.006006, 0.011500, 0.017475, 0.022002, 0.025563, 0.030486, 0.035912, 0.039502, 0.045762, 0.049134, 0.048098, 0.049945, 0.048632, 0.050873, 0.051775, 0.051471, 0.049459
#*# 	  -0.000353, 0.009353, 0.017072, 0.018480, 0.019421, 0.024551, 0.028930, 0.032573, 0.035882, 0.038233, 0.040476, 0.043904, 0.048375, 0.051288, 0.053715, 0.056538, 0.060246, 0.064242, 0.064516, 0.066610
#*# 	  0.001513, 0.005985, 0.010129, 0.009811, 0.013276, 0.021575, 0.026133, 0.032413, 0.036359, 0.038501, 0.043023, 0.048218, 0.050547, 0.053339, 0.053588, 0.056838, 0.059106, 0.062332, 0.064296, 0.064500
#*# 	  0.068356, 0.052770, 0.040947, 0.037689, 0.035767, 0.038484, 0.042028, 0.046693, 0.050571, 0.054101, 0.056524, 0.060018, 0.060958, 0.060458, 0.059551, 0.059204, 0.060710, 0.062708, 0.063942, 0.062788
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 25.0
#*# max_x = 275.0
#*# min_y = 25.0
#*# max_y = 265.0
