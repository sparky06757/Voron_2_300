[include mainsail.cfg]
[include Macros.cfg]
[include DB_RB_led.cfg]
[include K-ShakeTune/*.cfg]

[delayed_gcode pre_heat]
initial_duration: .01
gcode:
  ABS_PREHEAT


[exclude_object]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_30003A001750344D30353320-if00
restart_method: command

[mcu can0]
canbus_uuid: eb442146719f  #e87c5e5749f2

# [mcu RPi4]
# serial: /tmp/klipper_host_mcu

[temperature_sensor Octopus]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[temperature_sensor can0]
sensor_type: temperature_mcu
sensor_mcu: can0
min_temp: 0
max_temp: 100

# [temperature_sensor RPi4]
# sensor_type: temperature_host
# min_temp: 0
# max_temp: 100

[temperature_sensor chamber]
sensor_type: Generic 3950
Sensor_pin: PF4

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[skew_correction]

[mcu scanner]
canbus_uuid: 7648b477a9a0 

[scanner]
mcu: scanner            
x_offset: 0                          
y_offset: 15                         
backlash_comp: 0.5
sensor: cartographer
sensor_alt: carto      
mesh_runs: 2

[bed_mesh]
zero_reference_position: 150, 150    
speed: 400
horizontal_move_z: 5
mesh_min: 25,25
mesh_max: 275, 275
probe_count: 20, 20
algorithm: bicubic

# [lis2dw]
# cs_pin: scanner:PA3
# spi_bus: spi1

# [resonance_tester]
# accel_chip: lis2dw
# probe_points:
#     150, 150, 20

[autotune_tmc stepper_x]
motor: ldo-42sth48-2004mah
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_y]
motor: ldo-42sth48-2004mah
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z1]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z2]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z3]
motor: ldo-42sth48-2004ac
tuning_goal: auto
voltage: 24

[input_shaper]
shaper_freq_x: 62.2 # center frequency for the X axis filter
shaper_type_x: mzv # filter type for the X axis
damping_ratio_x: 0.042 # damping ratio for the X axis
shaper_freq_y: 44.4 # center frequency for the Y axis filter
shaper_type_y: mzv # filter type for the Y axis
damping_ratio_y: 0.044 # damping ratio for the Y axis

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 12000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 300
square_corner_velocity: 5.0
minimum_cruise_ratio: 0.5

[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400
endstop_pin: can0:PB8
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 80
homing_retract_dist: 0
homing_positive_dir: True

[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400
endstop_pin: PG9
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 80  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32
endstop_pin: probe:z_virtual_endstop     
position_max: 255
position_min: -5
homing_speed: 15
second_homing_speed: 3
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PC6
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z3]
step_pin: PC13
dir_pin: PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: False
run_current: 1.1
sense_resistor: 0.110
stealthchop_threshold: 0

[extruder]
step_pin: can0:PD0
dir_pin: !can0:PD1
enable_pin: !can0:PD2
rotation_distance: 22.67895
gear_ratio: 50:7
microsteps: 16
full_steps_per_rotation: 200
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
max_extrude_cross_section: 50
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: can0:PB13
sensor_pin: can0:PA3
sensor_type: ATC Semitec 104NT-4-R025H42G
#pullup_resistor: 2200
#control: pid
#pid_Kp: 21.507
#pid_Ki: 1.887
#pid_Kd: 61.296
min_extrude_temp: 200
min_temp: 0
max_temp: 305
pressure_advance: .04
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: can0:PA15
interpolate: true
run_current: 0.8
hold_current: 0.100
sense_resistor: 0.11
stealthchop_threshold: 0
driver_TBL: 0
driver_HEND: 6
driver_HSTRT: 7
driver_TOFF: 4

[filament_motion_sensor filament_sensor]
detection_length: 12
extruder: extruder
switch_pin: ^PG15
pause_on_runout: True
event_delay: 3.0
pause_delay: 0.5
runout_gcode:
    M117 Runout Detected!

# [filament_motion_sensor encoder_sensor]
# detection_length: 12
# extruder: extruder
# switch_pin: PG15
# # changing the switch_pin name according to your motherboard
# #pause_on_runout: True
# #runout_gcode: [pause_resume]
# #insert_gcode:
# #event_delay: 
# #pause_delay:

[gcode_arcs]
resolution: 1.0

[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PF3
max_power: 0.6
min_temp: 0
max_temp: 125
pwm_cycle_time: 0.0166
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

[verify_heater heater_bed]
max_error: 50
check_gain_time: 99999
hysteresis: 5
heating_gain: 2

[idle_timeout]
timeout: 26000

[heater_fan hotend_fan]
#  Hotend Fan - FAN1
pin: can0: PA0
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 35
fan_speed: 1.0

## PART COOLING - FAN2
[fan]
pin: can0: PA1
kick_start_time: 0.5
#cycle_time: 0.15
off_below: 0.10

[heater_fan Electronics_Right]
pin: PD13
kick_start_time: 0.5
shutdown_speed: 0.0
heater: heater_bed
heater_temp: 50
fan_speed: .35

[heater_fan Electronics_Left]
pin: PD14
kick_start_time: 0.5
shutdown_speed: 0.0
heater: heater_bed
heater_temp: 50
fan_speed: .35

[heater_fan Nevermore]
pin: PD12
max_power: 1.0
kick_start_time: 0.5
heater: heater_bed
heater_temp: 50.0

[safe_z_home]                 
home_xy_position: 150,150
z_hop: 10


[quad_gantry_level]
gantry_corners:
	-60,-10
	360,370
points:
    25,0
    25,250
    275,250
    275,0
speed: 500
horizontal_move_z: 5
retries: 10
retry_tolerance: 0.006
max_adjust: 10


# [bed_mesh]
# speed: 400
# horizontal_move_z: 7
# mesh_min: 25,25
# mesh_max: 275,265
# fade_start: 0.6
# fade_end: 10.0
# probe_count: 30,30
# mesh_pps:2,2
# algorithm: bicubic

[bed_mesh] #cart bed mesh
zero_reference_position: 150, 150  
speed: 400
horizontal_move_z: 5
mesh_min: 25, 25
mesh_max: 275, 265
probe_count: 20, 20

[adxl345]
cs_pin: can0: PB12
spi_software_sclk_pin: can0:PB10
spi_software_mosi_pin: can0:PB11
spi_software_miso_pin: can0:PB2
axes_map: x,y,z

[resonance_tester]
accel_chip: adxl345
probe_points:
   150,150,20

# Chamber Lighting
[output_pin caselight]
pin: PD15
#max_power: 1.0
#kick_start_time: 0.5
pwm: true
shutdown_value: 0
value: 1
cycle_time: 0.01
#scale: 100

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.133
#*# pid_ki = 1.324
#*# pid_kd = 289.094
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.058
#*# pid_ki = 1.438
#*# pid_kd = 69.955
#*#
#*# [input_shaper]
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = -2.220446049250313e-16
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [scanner model default]
#*# model_coef = 1.3675403272547682,
#*# 	  1.7937619056573224,
#*# 	  0.7553799487518319,
#*# 	  0.3877014150198633,
#*# 	  0.4184032998143007,
#*# 	  0.2991069507591693,
#*# 	  -0.2744815254069319,
#*# 	  -0.21061287405141232,
#*# 	  0.2826175667767271,
#*# 	  0.1804372746066715
#*# model_domain = 3.219964566634026e-07,3.359593890061353e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 22.690366
#*# model_offset = 0.46000
#*# model_mode = scan
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.052635, 0.067396, 0.075971, 0.081674, 0.086179, 0.087354, 0.090587, 0.103089, 0.106290, 0.109306, 0.113799, 0.114013, 0.113618, 0.114127, 0.106843, 0.098817, 0.089055, 0.083317, 0.073858, 0.058871
#*# 	  0.033050, 0.042298, 0.052592, 0.054623, 0.058950, 0.064797, 0.069045, 0.071021, 0.075297, 0.076133, 0.084858, 0.087111, 0.084616, 0.086806, 0.083247, 0.068080, 0.062822, 0.057680, 0.049442, 0.030695
#*# 	  0.023102, 0.032729, 0.039543, 0.045810, 0.042990, 0.051925, 0.062016, 0.059756, 0.063070, 0.066612, 0.072380, 0.073020, 0.071057, 0.068590, 0.064791, 0.064067, 0.052510, 0.042864, 0.038166, 0.026237
#*# 	  0.003690, 0.017597, 0.023242, 0.029445, 0.041564, 0.044957, 0.046495, 0.051613, 0.057950, 0.062551, 0.066309, 0.066984, 0.065655, 0.060101, 0.060297, 0.060150, 0.052804, 0.048796, 0.039829, 0.029828
#*# 	  -0.013050, 0.004811, 0.009857, 0.009578, 0.017187, 0.024526, 0.031366, 0.039322, 0.044890, 0.049885, 0.045926, 0.044792, 0.048828, 0.046788, 0.047076, 0.044082, 0.037593, 0.029668, 0.025328, 0.011767
#*# 	  -0.015337, -0.002778, 0.002625, 0.007800, 0.011999, 0.015681, 0.021060, 0.023990, 0.027251, 0.030628, 0.041308, 0.041585, 0.035399, 0.032381, 0.026051, 0.031573, 0.029681, 0.022755, 0.013338, 0.007013
#*# 	  -0.018131, -0.009304, -0.004622, -0.003359, 0.002678, 0.006470, 0.016999, 0.020114, 0.021083, 0.027145, 0.030207, 0.025746, 0.018207, 0.022162, 0.020248, 0.016166, 0.014728, 0.012135, 0.005511, -0.003434
#*# 	  -0.026501, -0.022472, -0.018017, -0.013087, -0.010936, -0.005230, -0.003498, 0.000808, 0.011033, 0.009073, 0.014224, 0.016984, 0.010176, 0.010851, 0.006769, 0.004521, 0.010199, 0.011818, 0.007443, -0.002502
#*# 	  -0.044453, -0.037522, -0.028590, -0.026026, -0.024535, -0.018104, -0.013595, -0.011636, -0.004114, 0.007599, 0.017309, 0.011409, 0.010429, 0.007550, 0.004179, 0.006406, 0.016041, 0.014562, 0.009077, 0.006698
#*# 	  -0.042402, -0.041689, -0.036346, -0.027625, -0.022666, -0.019769, -0.014898, -0.007416, 0.002662, 0.012630, 0.013958, 0.014218, 0.010185, 0.013967, 0.011662, 0.014253, 0.014265, 0.014298, 0.013433, 0.008314
#*# 	  -0.048854, -0.049486, -0.045682, -0.039067, -0.033835, -0.028810, -0.023832, -0.013990, -0.005344, -0.000357, 0.002458, 0.004185, 0.007567, 0.008558, 0.008980, 0.008046, 0.010290, 0.010985, 0.007698, 0.006502
#*# 	  -0.043103, -0.041972, -0.046848, -0.045447, -0.039554, -0.034921, -0.028350, -0.021911, -0.014509, -0.010120, -0.003467, 0.000833, -0.000213, 0.001661, 0.001697, 0.005280, 0.008453, 0.006623, 0.008316, 0.007733
#*# 	  -0.022731, -0.022645, -0.034930, -0.041274, -0.042390, -0.037412, -0.029865, -0.023313, -0.012779, -0.005228, -0.000151, -0.000987, 0.002013, 0.003542, 0.004721, 0.007461, 0.012182, 0.014383, 0.013892, 0.012802
#*# 	  -0.014246, -0.016375, -0.026852, -0.035893, -0.036051, -0.031976, -0.026599, -0.020213, -0.013329, -0.005033, 0.000257, 0.004430, 0.004360, 0.005813, 0.008603, 0.010856, 0.015502, 0.018157, 0.019048, 0.019166
#*# 	  -0.019613, -0.015076, -0.019414, -0.025504, -0.025087, -0.020583, -0.015252, -0.009492, -0.002005, 0.006310, 0.011911, 0.018176, 0.021007, 0.022058, 0.026969, 0.029587, 0.035489, 0.041193, 0.043289, 0.046914
#*# 	  -0.020662, -0.012670, -0.011851, -0.010899, -0.010945, -0.005345, 0.001969, 0.008497, 0.018707, 0.025724, 0.031556, 0.035675, 0.037303, 0.039262, 0.040331, 0.044019, 0.048685, 0.051493, 0.051148, 0.050702
#*# 	  -0.010249, -0.007989, -0.000100, 0.002885, 0.006114, 0.012305, 0.017175, 0.022068, 0.030273, 0.033184, 0.038766, 0.042839, 0.045100, 0.047257, 0.047297, 0.047665, 0.048991, 0.050664, 0.050612, 0.050048
#*# 	  -0.003335, 0.007779, 0.012062, 0.016460, 0.019431, 0.022724, 0.028603, 0.032900, 0.035433, 0.037780, 0.041305, 0.043175, 0.048478, 0.051567, 0.054298, 0.056098, 0.060223, 0.064861, 0.066390, 0.068482
#*# 	  0.002987, 0.006562, 0.008490, 0.011298, 0.016248, 0.021968, 0.028156, 0.034198, 0.039188, 0.039349, 0.044551, 0.049240, 0.052692, 0.054312, 0.054913, 0.058902, 0.062054, 0.066229, 0.068165, 0.068553
#*# 	  0.074920, 0.054469, 0.045362, 0.040159, 0.043033, 0.044224, 0.048565, 0.053529, 0.056787, 0.061027, 0.062311, 0.065824, 0.064164, 0.065600, 0.064850, 0.064725, 0.067183, 0.069310, 0.068742, 0.068529
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 25.0
#*# max_x = 275.0
#*# min_y = 25.0
#*# max_y = 265.0
